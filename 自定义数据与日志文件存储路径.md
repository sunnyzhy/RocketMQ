# 自定义数据与日志文件存储路径

## 修改 store 路径
### 1. 复制 broker.properties
```
# cd conf

# cp 2m-noslave\broker-a.properties broker.properties
```

### 2. 在 broker.properties 里添加以下配置信息
```
diskMaxUsedSpaceRatio=90
storePathRootDir=/usr/local/rocketmq/store
storePathCommitLog=/usr/local/rocketmq/store/commitLog
```

### 3. 启动 broker
```
# nohup sh ./mqbroker -n 127.0.0.1:9876  -c ../conf/broker.properties &
```

## 修改 logs 路径
修改 logback_broker.xml、logback_filtersrv.xml、logback_namesrv.xml、logback_tools.xml 的方法都相同。

### 1. 打开 conf 目录
```
# cd conf
```

### 2. 在 xml 配置文件里添加 property 节点
```xml
<configuration>
	<property name="logPath" value="/usr/local/rocketmq"></property>
  <appender ...
```

### 3. 把 ${user.home} 替换为 ${logPath}

### 4. 启动 namesrv
```
# nohup sh ./mqnamesrv &
```

### 5. 启动 broker
```
# nohup sh ./mqbroker -n 127.0.0.1:9876  -c ../conf/broker.properties &
```

## 修改 rocketmq_client.log 路径
### 1. 下载 rocketmq 源码
[rocketmq源码](https://github.com/apache/rocketmq/ 'rocketmq')

### 2. 修改 rocketmq-client 的存储路径
org.apache.rocketmq.client.log.ClientLogger

```java
public class ClientLogger {
// ...

    private static synchronized Appender createClientAppender() {
        // String clientLogRoot = System.getProperty(CLIENT_LOG_ROOT, System.getProperty("user.home") + "/logs/rocketmqlogs");
	String clientLogRoot = System.getProperty(CLIENT_LOG_ROOT, System.getProperty("client.log.path") + "/logs/rocketmqlogs");
        String clientLogMaxIndex = System.getProperty(CLIENT_LOG_MAXINDEX, "10");
        String clientLogFileName = System.getProperty(CLIENT_LOG_FILENAME, "rocketmq_client.log");
        String maxFileSize = System.getProperty(CLIENT_LOG_FILESIZE, "1073741824");
        String asyncQueueSize = System.getProperty(CLIENT_LOG_ASYNC_QUEUESIZE, "1024");
	// ...
    }
    
}
```

### 3. 全局修改 rocketmq 的存储路径
全局替换源码工程里的 user.home 参数为 client.log.path

### 4. 打包 rocketmq 工程

### 5. 替换原来的 jar 文件
用打包好的 jar 文件替换 rocketmq-all-4.7.1-bin-release/lib 目录下的 jar 文件

### 6. 添加 rocketmq 的启动参数
在 runbroker.sh 和 runserver.sh 文件里添加启动参数

```bash
# cd bin

# vim runbroker.sh
JAVA_OPT="${JAVA_OPT} -Dclient.log.path=/usr/rocketmq"

# vim runserver.sh
JAVA_OPT="${JAVA_OPT} -Dclient.log.path=/usr/rocketmq"
```
